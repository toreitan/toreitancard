<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShadowverseÈ¢®„Ç´„Éº„Éâ„Ç≤„Éº„É†</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card {
      width: 150px;
      height: 220px;
      border: 2px solid #000;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 10px;
      background: white;
      cursor: pointer;
      user-select: none;
      font-size: 14px;
    }
    .mulligan-card {
      width: 80px;
      height: 117px;
      font-size: 10px;
      padding: 5px;
    }
    .mulligan-card .card-name {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .card.dragging {
      opacity: 0.8;
    }
    .card.attackable:hover {
      border-color: #ff0000;
      transform: scale(1.05);
    }
    .card.attacked {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .card.guard {
      border-color: #1e90ff;
      background: linear-gradient(to bottom, #e6f3ff, #b3d9ff);
      position: relative;
    }
    .card.guard::before {
      content: "üõ°Ô∏è";
      position: absolute;
      top: 4px;
      right: 4px;
      font-size: 12px;
    }
    .card.selected {
      border-color: #ff8c00;
      background: linear-gradient(to bottom, #fff7e6, #ffdab9);
    }
    .play-area {
      min-height: 240px;
      border: 2px dashed #666;
    }
    .card.effect {
      background: linear-gradient(to bottom, #f0f8ff, #e6e6fa);
    }
    .drop-target:hover {
      border: 2px dashed #ff0000;
    }
    #game-result, #mulligan-screen, #card-detail-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #game-result.show, #mulligan-screen.show, #card-detail-modal.show {
      display: flex;
    }
    #game-result div {
      background: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      max-width: 500px;
      width: 90%;
    }
    #mulligan-screen div {
      background: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      max-width: 600px;
      width: 90%;
    }
    #mulligan-cards {
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 16px;
      max-width: 480px;
    }
    .tooltip {
      position: relative;
    }
    .tooltip:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 110%;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: white;
      padding: 2px 4px;
      border-radius: 4px;
      font-size: 8px;
      white-space: nowrap;
      z-index: 30;
    }
    #card-detail-modal div {
      background: white;
      padding: 16px;
      border-radius: 8px;
      text-align: left;
      max-width: 300px;
      width: 90%;
      font-size: 16px;
      position: relative;
    }
    .close-button {
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 20px;
      cursor: pointer;
      color: #333;
    }
    .close-button:hover {
      color: #ff0000;
    }
  </style>
</head>
<body class="bg-gray-100 flex flex-col items-center py-4">
  <h1 class="text-3xl font-bold mb-4">Shadowverse: „Éü„Éã„Ç≤„Éº„É†</h1>
  <div id="game-status" class="mb-4 text-lg font-semibold"></div>
  <div class="flex w-full max-w-5xl mx-auto">
    <div id="player-info" class="w-1/4 p-4 bg-green-100 rounded-lg mr-2">
      <h2 class="text-xl font-semibold">„Éó„É¨„Ç§„É§„Éº</h2>
      <p id="player-mana">„Éû„Éä: 0/0</p>
      <p id="player-life">„É©„Ç§„Éï: 20</p>
    </div>
    <div id="ai-info" class="w-1/4 p-4 bg-blue-100 rounded-lg mr-2 drop-target">
      <h2 class="text-xl font-semibold">AI</h2>
      <p id="ai-mana">„Éû„Éä: 0/0</p>
      <p id="ai-life">„É©„Ç§„Éï: 20</p>
    </div>
    <div id="play-area" class="w-1/2 p-4 bg-gray-200 rounded-lg play-area">
      <h2 class="text-xl font-semibold">„Éó„É¨„Ç§„Ç®„É™„Ç¢</h2>
      <div id="ai-field" class="flex flex-wrap gap-2 mb-2 border-b-2 border-gray-400 pb-2 drop-target"></div>
      <div id="player-field" class="flex flex-wrap gap-2"></div>
    </div>
  </div>
  <div id="player-hand" class="w-full max-w-5xl mx-auto p-4 bg-green-200 rounded-lg mt-4">
    <h2 class="text-xl font-semibold">„Éó„É¨„Ç§„É§„Éº„ÅÆÊâãÊú≠</h2>
    <div id="player-cards" class="flex flex-wrap gap-2"></div>
  </div>
  <button id="end-turn" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">„Çø„Éº„É≥ÁµÇ‰∫Ü</button>
  <div id="game-result">
    <div>
      <h2 id="result-text" class="text-2xl font-bold mb-4"></h2>
      <button id="reset-button" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">„É™„Çª„ÉÉ„Éà</button>
    </div>
  </div>
  <div id="mulligan-screen">
    <div>
      <h2 class="text-2xl font-bold mb-6">ÊâãÊú≠„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h2>
      <div id="mulligan-cards"></div>
      <button id="mulligan-confirm" class="mt-6 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">„Éû„É™„Ç¨„É≥Á¢∫ÂÆö</button>
    </div>
  </div>
  <div id="card-detail-modal">
    <div>
      <span id="close-detail" class="close-button">√ó</span>
      <div id="card-detail-content"></div>
    </div>
  </div>

  <script>
    // „É©„É≥„ÉÄ„É†„Ç´„Éº„Éâ„Éá„Éº„ÇøÁîüÊàê
    const classes = ["„Éï„Ç©„É¨„Çπ„Éà„ÇØ„É©„Éï„Éà", "„ÇΩ„Éº„Éâ„ÇØ„É©„Éï„Éà", "„É´„Éº„É≥„ÇØ„É©„Éï„Éà", "„Éâ„É©„Ç¥„É≥„ÇØ„É©„Éï„Éà", "„Ç¢„Éì„Çπ„ÇØ„É©„Éï„Éà", "„Éè„É¥„É≥„ÇØ„É©„Éï„Éà", "„Éã„É•„Éº„Éà„É©„É´"];
    const prefixes = ["„Éû„Ç∏„ÉÉ„ÇØ", "„Éñ„É¨„Ç§„Éñ", "„ÉÄ„Éº„ÇØ", "„Éõ„Éº„É™„Éº", "„Éï„É¨„Ç§„É†", "„Ç∑„É£„Éâ„Ç¶", "„Éü„Çπ„ÉÜ„Ç£„ÉÉ„ÇØ", "„Ç∑„É´„Éê„Éº", "„Ç¥„Éº„É´„Éá„É≥", "„ÇØ„É™„Çπ„Çø„É´"];
    const suffixes = ["„Éä„Ç§„Éà", "„Éâ„É©„Ç¥„É≥", "„Ç¶„Ç£„Ç∂„Éº„Éâ", "„Éï„Çß„Ç¢„É™„Éº", "„ÇΩ„É´„Ç∏„É£„Éº", "„É™„Éº„Éë„Éº", "„Éì„Éº„Çπ„Éà", "„Ç¨„Éº„Éá„Ç£„Ç¢„É≥", "„É°„Ç§„Ç∏", "„Éó„É™„Éº„Çπ„Éà"];
    const effects = ["none", "none", "none", "none", "none", "rush", "rush", "guard", "guard", "boost", "boost", "fanfare"];
    const effectDescriptions = {
      none: "ÂäπÊûú„Å™„Åó",
      rush: "Á™ÅÈÄ≤: Â†¥„Å´Âá∫„Åü„Çø„Éº„É≥„Å´ÊîªÊíÉÂèØËÉΩ",
      guard: "ÂÆàË≠∑: „É©„Ç§„Éï„ÇÑÈùûÂÆàË≠∑„Ç´„Éº„Éâ„Å∏„ÅÆÊîªÊíÉ„Çí„Éñ„É≠„ÉÉ„ÇØ",
      boost: "„Éñ„Éº„Çπ„Éà: „Éê„Éà„É´„Ç®„É™„Ç¢„Å´Âá∫„Å¶„ÅÑ„ÇãÊôÇ„ÄÅÊâãÊú≠„Åã„Çâ„Ç´„Éº„Éâ‰ΩøÁî®„Åß‰ΩìÂäõ+1",
      fanfare: "„Éï„Ç°„É≥„Éï„Ç°„Éº„É¨: Â†¥„Å´Âá∫„ÅüÊôÇ„ÄÅÊîªÊíÉÂäõ+1"
    };

    const cardsData = [
      { id: 0, name: "„Ç¨„Éº„Éá„Ç£„Ç¢„É≥„Éä„Ç§„Éà", class: "„ÇΩ„Éº„Éâ„ÇØ„É©„Éï„Éà", cost: 3, attack: 3, health: 5, effect: "guard" },
      { id: 1, name: "„Ç¢„Ç§„Ç¢„É≥„Ç¨„Éº„Éá„Ç£„Ç¢„É≥", class: "„Éã„É•„Éº„Éà„É©„É´", cost: 5, attack: 5, health: 7, effect: "guard" },
      { id: 2, name: "„Éõ„Éº„É™„Éº„Ç¶„Ç©„Éº„Éá„É≥", class: "„Éè„É¥„É≥„ÇØ„É©„Éï„Éà", cost: 7, attack: 7, health: 9, effect: "guard" },
      ...Array.from({ length: 27 }, (_, i) => {
        const cost = Math.floor(i / 3) + 1;
        let attack, health;
        if (cost === 1) {
          attack = Math.floor(Math.random() * 2) + 1;
          health = Math.floor(Math.random() * 2) + 1;
        } else if (cost === 2) {
          attack = Math.floor(Math.random() * 2) + 2;
          health = attack + Math.floor(Math.random() * 2) + 1;
        } else if (cost === 3) {
          attack = Math.floor(Math.random() * 2) + 3;
          health = attack + Math.floor(Math.random() * 2) + 1;
        } else {
          attack = Math.max(1, Math.floor(cost * 1.0 + Math.random() * 3));
          health = attack + Math.floor(Math.random() * 4) + 2;
        }
        const effect = effects[Math.floor(Math.random() * effects.length)];
        return {
          id: i + 3,
          name: `${prefixes[Math.floor(Math.random() * prefixes.length)]}${suffixes[Math.floor(Math.random() * suffixes.length)]}`,
          class: classes[Math.floor(Math.random() * classes.length)],
          cost,
          attack,
          health,
          effect,
        };
      }),
    ];

    let playerHand = [];
    let playerField = [];
    let aiHand = [];
    let aiField = [];
    let playerMana = 1;
    let maxPlayerMana = 1;
    let aiMana = 1;
    let maxAiMana = 1;
    let playerLife = 20;
    let aiLife = 20;
    let currentTurn = "player";
    let turnCount = 1;
    let gameOver = false;
    let isMulliganPhase = true;
    let selectedCards = [];

    function initializeGame() {
      try {
        playerHand = drawCards(5);
        aiHand = drawCards(5);
        playerField = [];
        aiField = [];
        playerMana = 1;
        maxPlayerMana = 1;
        aiMana = 1;
        maxAiMana = 1;
        playerLife = 20;
        aiLife = 20;
        turnCount = 1;
        currentTurn = "player";
        gameOver = false;
        isMulliganPhase = true;
        selectedCards = [];
        document.getElementById("game-result").classList.remove("show");
        document.getElementById("mulligan-screen").classList.add("show");
        document.getElementById("card-detail-modal").classList.remove("show");
        updateMulliganDisplay();
        updateGameStatus();
        console.log(`„Ç≤„Éº„É†ÂàùÊúüÂåñ - „Éó„É¨„Ç§„É§„Éº„Éû„Éä: ${playerMana}/${maxPlayerMana}, AI„Éû„Éä: ${aiMana}/${maxAiMana}, „Éû„É™„Ç¨„É≥ÈñãÂßã`);
        console.log("„Ç´„Éº„Éâ„Éá„Éº„Çø:", JSON.stringify(cardsData, null, 2));
      } catch (error) {
        console.error("„Ç≤„Éº„É†ÂàùÊúüÂåñ„Ç®„É©„Éº:", error.stack);
      }
    }

    function drawCards(num) {
      const hand = [];
      for (let i = 0; i < num; i++) {
        const randomCard = cardsData[Math.floor(Math.random() * cardsData.length)];
        hand.push({ ...randomCard, canAttack: false });
      }
      return hand;
    }

    function updateMulliganDisplay() {
      try {
        const mulliganCardsDiv = document.getElementById("mulligan-cards");
        mulliganCardsDiv.innerHTML = "";
        playerHand.forEach((card, index) => {
          const cardElement = document.createElement("div");
          cardElement.className = `card mulligan-card ${card.effect !== "none" ? "effect" : ""} ${selectedCards.includes(index) ? "selected" : ""} ${card.effect === "guard" ? "guard" : ""}`;
          cardElement.setAttribute("data-index", index);
          cardElement.innerHTML = `
            <div class="font-bold card-name">${card.name}</div>
            <div>„ÇØ„É©„Çπ: ${card.class}</div>
            <div>„Ç≥„Çπ„Éà: ${card.cost}</div>
            <div>ÊîªÊíÉ: ${card.attack} / ‰ΩìÂäõ: ${card.health}</div>
            <div class="tooltip" data-tooltip="${effectDescriptions[card.effect] || "ÂäπÊûú„Å™„Åó"}">ÂäπÊûú: ${card.effect || "-"}</div>
          `;
          cardElement.addEventListener("click", () => handleMulliganCardClick(index));
          cardElement.addEventListener("contextmenu", (e) => {
            e.preventDefault();
            showCardDetail(index);
          });
          mulliganCardsDiv.appendChild(cardElement);
        });
        console.log(`„Éû„É™„Ç¨„É≥Ë°®Á§∫Êõ¥Êñ∞ - ÈÅ∏Êäû„Ç´„Éº„Éâ: ${selectedCards.length > 0 ? selectedCards.map(i => playerHand[i].name).join(", ") : "„Å™„Åó"}`);
      } catch (error) {
        console.error("„Éû„É™„Ç¨„É≥Ë°®Á§∫„Ç®„É©„Éº:", error.stack);
      }
    }

    function showCardDetail(index) {
      try {
        const card = playerHand[index];
        if (!card) {
          console.log("„Ç´„Éº„ÉâË©≥Á¥∞Ë°®Á§∫Â§±Êïó: „Ç´„Éº„Éâ„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑ", { index, playerHand });
          return;
        }
        const detailContent = document.getElementById("card-detail-content");
        detailContent.innerHTML = `
          <div class="font-bold text-xl mb-2">${card.name}</div>
          <div>„ÇØ„É©„Çπ: ${card.class}</div>
          <div>„Ç≥„Çπ„Éà: ${card.cost}</div>
          <div>ÊîªÊíÉ: ${card.attack} / ‰ΩìÂäõ: ${card.health}</div>
          <div>ÂäπÊûú: ${effectDescriptions[card.effect] || "ÂäπÊûú„Å™„Åó"}</div>
        `;
        document.getElementById("card-detail-modal").classList.add("show");
        console.log(`„Ç´„Éº„ÉâË©≥Á¥∞Ë°®Á§∫: ${card.name}`);
      } catch (error) {
        console.error("„Ç´„Éº„ÉâË©≥Á¥∞Ë°®Á§∫„Ç®„É©„Éº:", error.stack);
      }
    }

    function handleMulliganCardClick(index) {
      try {
        if (selectedCards.includes(index)) {
          selectedCards = selectedCards.filter(i => i !== index);
          console.log(`„Éû„É™„Ç¨„É≥ÈÅ∏ÊäûËß£Èô§: ${playerHand[index].name}`);
        } else {
          selectedCards.push(index);
          console.log(`„Éû„É™„Ç¨„É≥ÈÅ∏Êäû: ${playerHand[index].name}`);
        }
        updateMulliganDisplay();
      } catch (error) {
        console.error("„Éû„É™„Ç¨„É≥ÈÅ∏Êäû„Ç®„É©„Éº:", error.stack);
      }
    }

    function performMulligan() {
      try {
        if (selectedCards.length > 0) {
          console.log(`„Éû„É™„Ç¨„É≥ÂÆüË°å - ‰∫§Êèõ„Ç´„Éº„Éâ: ${selectedCards.map(i => playerHand[i].name).join(", ")}`);
          selectedCards.sort((a, b) => b - a);
          selectedCards.forEach(index => playerHand.splice(index, 1));
          playerHand.push(...drawCards(selectedCards.length));
        } else {
          console.log("„Éû„É™„Ç¨„É≥ÂÆüË°å - ‰∫§Êèõ„Å™„Åó");
        }
        isMulliganPhase = false;
        document.getElementById("mulligan-screen").classList.remove("show");
        updateGameDisplay();
        console.log("„Éû„É™„Ç¨„É≥ÂÆå‰∫Ü - „Ç≤„Éº„É†ÈñãÂßã");
      } catch (error) {
        console.error("„Éû„É™„Ç¨„É≥ÂÆüË°å„Ç®„É©„Éº:", error.stack);
      }
    }

    function updateGameDisplay() {
      try {
        document.getElementById("game-status").textContent = `„Çø„Éº„É≥: ${turnCount} (${currentTurn === "player" ? "„Éó„É¨„Ç§„É§„Éº" : "AI"})`;
        document.getElementById("player-mana").textContent = `„Éû„Éä: ${playerMana}/${maxPlayerMana}`;
        document.getElementById("player-life").textContent = `„É©„Ç§„Éï: ${playerLife}`;
        document.getElementById("ai-mana").textContent = `„Éû„Éä: ${aiMana}/${maxAiMana}`;
        document.getElementById("ai-life").textContent = `„É©„Ç§„Éï: ${aiLife}`;

        const playerCardsDiv = document.getElementById("player-cards");
        const playerFieldDiv = document.getElementById("player-field");
        const aiFieldDiv = document.getElementById("ai-field");

        playerCardsDiv.innerHTML = "";
        playerFieldDiv.innerHTML = "";
        aiFieldDiv.innerHTML = "";

        playerHand.forEach((card, index) => {
          const cardElement = createCardElement(card, index, "player-hand");
          playerCardsDiv.appendChild(cardElement);
        });

        playerField.forEach((card, index) => {
          const cardElement = createCardElement(card, index, "player-field");
          playerFieldDiv.appendChild(cardElement);
        });

        aiField.forEach((card, index) => {
          const cardElement = createCardElement(card, index, "ai-field");
          aiFieldDiv.appendChild(cardElement);
        });

        console.log(`Ë°®Á§∫Êõ¥Êñ∞ - „Éó„É¨„Ç§„É§„Éº„Éû„Éä: ${playerMana}/${maxPlayerMana}, AI„Éû„Éä: ${aiMana}/${maxAiMana}, „É©„Ç§„Éï - „Éó„É¨„Ç§„É§„Éº: ${playerLife}, AI: ${aiLife}`);
        console.log(`„Éó„É¨„Ç§„É§„ÉºÊâãÊú≠:`, playerHand.map(c => c.name));
        console.log(`„Éó„É¨„Ç§„É§„ÉºÂ†¥„Ç´„Éº„Éâ:`, playerField.map(c => ({ name: c.name, canAttack: c.canAttack, effect: c.effect })));
        console.log(`AIÂ†¥„Ç´„Éº„Éâ:`, aiField.map(c => ({ name: c.name, canAttack: c.canAttack, effect: c.effect })));
      } catch (error) {
        console.error("Ë°®Á§∫Êõ¥Êñ∞„Ç®„É©„Éº:", error.stack);
      }
    }

    function createCardElement(card, index, type) {
      try {
        const cardDiv = document.createElement("div");
        cardDiv.className = `card ${card.effect !== "none" ? "effect" : ""} ${type === "player-field" && card.canAttack && currentTurn === "player" && !gameOver && !isMulliganPhase ? "attackable" : ""} ${type === "player-field" && !card.canAttack ? "attacked" : ""} ${type === "ai-field" && currentTurn === "player" && !gameOver && !isMulliganPhase ? "drop-target" : ""} ${card.effect === "guard" ? "guard" : ""}`;
        cardDiv.setAttribute("data-index", index);
        cardDiv.setAttribute("data-type", type);
        if (type === "player-hand" && !isMulliganPhase || (type === "player-field" && card.canAttack && currentTurn === "player" && !gameOver && !isMulliganPhase)) {
          cardDiv.setAttribute("draggable", "true");
        }
        cardDiv.innerHTML = `
          <div class="font-bold">${card.name}</div>
          <div>„ÇØ„É©„Çπ: ${card.class}</div>
          <div>„Ç≥„Çπ„Éà: ${card.cost}</div>
          <div>ÊîªÊíÉ: ${card.attack} / ‰ΩìÂäõ: ${card.health}</div>
          <div class="tooltip" data-tooltip="${effectDescriptions[card.effect] || "ÂäπÊûú„Å™„Åó"}">ÂäπÊûú: ${card.effect || "-"}</div>
        `;
        if (type === "player-hand" && !isMulliganPhase || (type === "player-field" && card.canAttack && currentTurn === "player" && !gameOver && !isMulliganPhase)) {
          cardDiv.addEventListener("dragstart", handleDragStart);
          cardDiv.addEventListener("dragend", handleDragEnd);
        }
        return cardDiv;
      } catch (error) {
        console.error("„Ç´„Éº„Éâ‰ΩúÊàê„Ç®„É©„Éº:", error.stack);
        return document.createElement("div");
      }
    }

    function handleDragStart(event) {
      try {
        if (gameOver || isMulliganPhase) {
          console.log(`„Éâ„É©„ÉÉ„Ç∞ÈñãÂßãÂ§±Êïó: ${gameOver ? "„Ç≤„Éº„É†ÁµÇ‰∫Ü‰∏≠" : "„Éû„É™„Ç¨„É≥‰∏≠"}`);
          return;
        }
        const index = event.target.getAttribute("data-index");
        const type = event.target.getAttribute("data-type");
        event.dataTransfer.setData("text/plain", JSON.stringify({ index: parseInt(index), type }));
        event.target.classList.add("dragging");
        console.log(`„Éâ„É©„ÉÉ„Ç∞ÈñãÂßã: ${type}, „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ: ${index}`);
      } catch (error) {
        console.error("„Éâ„É©„ÉÉ„Ç∞ÈñãÂßã„Ç®„É©„Éº:", error.stack);
      }
    }

    function handleDragEnd(event) {
      try {
        event.target.classList.remove("dragging");
        console.log(`„Éâ„É©„ÉÉ„Ç∞ÁµÇ‰∫Ü: ${event.target.getAttribute("data-type")}, „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ: ${event.target.getAttribute("data-index")}`);
      } catch (error) {
        console.error("„Éâ„É©„ÉÉ„Ç∞ÁµÇ‰∫Ü„Ç®„É©„Éº:", error.stack);
      }
    }

    function handlePlayDrop(event) {
      try {
        event.preventDefault();
        if (gameOver || isMulliganPhase) {
          console.log(`„Éó„É¨„Ç§„Éâ„É≠„ÉÉ„ÉóÂ§±Êïó: ${gameOver ? "„Ç≤„Éº„É†ÁµÇ‰∫Ü‰∏≠" : "„Éû„É™„Ç¨„É≥‰∏≠"}`);
          return;
        }
        if (currentTurn !== "player") {
          console.log("„Éó„É¨„Ç§„Éâ„É≠„ÉÉ„ÉóÂ§±Êïó: „Éó„É¨„Ç§„É§„Éº„ÅÆ„Çø„Éº„É≥„Åß„ÅØ„Å™„ÅÑ");
          return;
        }
        const data = JSON.parse(event.dataTransfer.getData("text/plain"));
        if (data.type !== "player-hand") {
          console.log("„Éó„É¨„Ç§„Éâ„É≠„ÉÉ„ÉóÂ§±Êïó: ÊâãÊú≠„Ç´„Éº„Éâ„Åß„ÅØ„Å™„ÅÑ", { data });
          return;
        }
        const cardIndex = data.index;
        const card = playerHand[cardIndex];
        if (!card) {
          console.log("„Éó„É¨„Ç§„Éâ„É≠„ÉÉ„ÉóÂ§±Êïó: „Ç´„Éº„Éâ„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑ", { cardIndex, playerHand });
          return;
        }
        if (playerMana < card.cost) {
          console.log(`„Éó„É¨„Ç§„Éâ„É≠„ÉÉ„ÉóÂ§±Êïó: „Éû„Éä‰∏çË∂≥ (ÂøÖË¶Å: ${card.cost}, ÁèæÂú®: ${playerMana})`);
          return;
        }
        if (playerField.length >= 5) {
          console.log("„Éó„É¨„Ç§„Éâ„É≠„ÉÉ„ÉóÂ§±Êïó: „Éó„É¨„Ç§„Ç®„É™„Ç¢„ÅåÊ∫ÄÊùØ");
          return;
        }
        let newCard = { ...card, canAttack: card.effect === "rush" };
        if (card.effect === "fanfare") {
          newCard.attack += 1;
          console.log(`„Éï„Ç°„É≥„Éï„Ç°„Éº„É¨Áô∫Âãï: ${card.name}, ÊîªÊíÉÂäõ+1 -> ${newCard.attack}`);
        }
        playerField.push(newCard);
        playerMana -= card.cost;
        playerHand.splice(cardIndex, 1);
        playerField.forEach(fieldCard => {
          if (fieldCard && fieldCard.effect === "boost") {
            fieldCard.health += 1;
            console.log(`„Éñ„Éº„Çπ„ÉàÁô∫Âãï: ${fieldCard.name}, ‰ΩìÂäõ+1 -> ${fieldCard.health}`);
          }
        });
        updateGameDisplay();
        console.log(`„Ç´„Éº„Éâ„Éó„É¨„Ç§: ${card.name}, ÊÆã„Éû„Éä: ${playerMana}, Â†¥„Ç´„Éº„ÉâÊï∞: ${playerField.length}`);
      } catch (error) {
        console.error("„Éó„É¨„Ç§„Éâ„É≠„ÉÉ„Éó„Ç®„É©„Éº:", error.stack);
      }
    }

    function handleAttackDrop(event) {
      try {
        event.preventDefault();
        if (gameOver || isMulliganPhase) {
          console.log(`ÊîªÊíÉ„Éâ„É≠„ÉÉ„ÉóÂ§±Êïó: ${gameOver ? "„Ç≤„Éº„É†ÁµÇ‰∫Ü‰∏≠" : "„Éû„É™„Ç¨„É≥‰∏≠"}`);
          return;
        }
        if (currentTurn !== "player") {
          console.log("ÊîªÊíÉ„Éâ„É≠„ÉÉ„ÉóÂ§±Êïó: „Éó„É¨„Ç§„É§„Éº„ÅÆ„Çø„Éº„É≥„Åß„ÅØ„Å™„ÅÑ");
          return;
        }
        const data = JSON.parse(event.dataTransfer.getData("text/plain"));
        if (data.type !== "player-field") {
          console.log("ÊîªÊíÉ„Éâ„É≠„ÉÉ„ÉóÂ§±Êïó: Â†¥„Ç´„Éº„Éâ„Åß„ÅØ„Å™„ÅÑ", { data });
          return;
        }
        const cardIndex = data.index;
        const attackingCard = playerField[cardIndex];
        if (!attackingCard || !attackingCard.canAttack) {
          console.log(`ÊîªÊíÉ„Éâ„É≠„ÉÉ„ÉóÂ§±Êïó: ÊîªÊíÉ‰∏çÂèØ ${attackingCard ? attackingCard.name : "‰∏çÊòé"} (canAttack: ${attackingCard ? attackingCard.canAttack : "N/A"})`);
          return;
        }

        const hasGuard = aiField.some(card => card && card.effect === "guard");
        const target = event.target.closest("#ai-info") || event.target.closest(".card[data-type='ai-field']");
        if (!target) {
          console.log("ÊîªÊíÉ„Éâ„É≠„ÉÉ„ÉóÂ§±Êïó: ÁÑ°Âäπ„Å™„Çø„Éº„Ç≤„ÉÉ„Éà");
          return;
        }

        if (target.id === "ai-info") {
          if (hasGuard) {
            console.log(`ÊîªÊíÉ„Éâ„É≠„ÉÉ„ÉóÂ§±Êïó: AIÂ†¥„Å´Guard„Ç´„Éº„Éâ„ÅåÂ≠òÂú® (${aiField.filter(c => c && c.effect === "guard").map(c => c.name).join(", ")})`);
            return;
          }
          aiLife -= attackingCard.attack;
          attackingCard.canAttack = false;
          updateGameDisplay();
          checkGameEnd();
          console.log(`Áõ¥Êé•ÊîªÊíÉ: ${attackingCard.name} -> AI„É©„Ç§„Éï, „ÉÄ„É°„Éº„Ç∏: ${attackingCard.attack}, AI„É©„Ç§„ÉïÊÆã: ${aiLife}`);
        } else {
          const aiCardIndex = parseInt(target.getAttribute("data-index"));
          const aiCard = aiField[aiCardIndex];
          if (!aiCard) {
            console.log("ÊîªÊíÉ„Éâ„É≠„ÉÉ„ÉóÂ§±Êïó: AI„Ç´„Éº„Éâ„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑ", { aiCardIndex, aiField });
            return;
          }
          if (hasGuard && aiCard.effect !== "guard") {
            console.log(`ÊîªÊíÉ„Éâ„É≠„ÉÉ„ÉóÂ§±Êïó: Guard„Ç´„Éº„Éâ„ÅåÂ≠òÂú®„Åô„Çã„Åå„ÄÅ${aiCard.name}„ÅØGuard„Åß„ÅØ„Å™„ÅÑ`);
            return;
          }
          aiCard.health -= attackingCard.attack;
          attackingCard.health -= aiCard.attack;
          playerField = playerField.filter(card => card && card.health > 0);
          aiField = aiField.filter(card => card && card.health > 0);
          attackingCard.canAttack = false;
          updateGameDisplay();
          checkGameEnd();
          console.log(`„Ç´„Éº„ÉâÊîªÊíÉ: ${attackingCard.name} -> ${aiCard.name}, „ÉÄ„É°„Éº„Ç∏: ${attackingCard.attack}/${aiCard.attack}`);
        }
      } catch (error) {
        console.error("ÊîªÊíÉ„Éâ„É≠„ÉÉ„Éó„Ç®„É©„Éº:", error.stack);
      }
    }

    function handleEndTurn() {
      try {
        if (gameOver || isMulliganPhase) {
          console.log(`„Çø„Éº„É≥ÁµÇ‰∫ÜÂ§±Êïó: ${gameOver ? "„Ç≤„Éº„É†ÁµÇ‰∫Ü‰∏≠" : "„Éû„É™„Ç¨„É≥‰∏≠"}`);
          return;
        }
        if (currentTurn !== "player") {
          console.log("„Çø„Éº„É≥ÁµÇ‰∫ÜÂ§±Êïó: „Éó„É¨„Ç§„É§„Éº„ÅÆ„Çø„Éº„É≥„Åß„ÅØ„Å™„ÅÑ");
          return;
        }
        currentTurn = "ai";
        turnCount++;
        maxPlayerMana = Math.min(maxPlayerMana + 1, 10);
        playerHand.push(...drawCards(1));
        updateGameDisplay();
        console.log(`„Éó„É¨„Ç§„É§„Éº„Çø„Éº„É≥ÁµÇ‰∫Ü - „Çø„Éº„É≥: ${turnCount}, „Éû„Éä: ${playerMana}/${maxPlayerMana}`);
        startAiTurn();
      } catch (error) {
        console.error("„Çø„Éº„É≥ÁµÇ‰∫Ü„Ç®„É©„Éº:", error.stack);
      }
    }

    function startPlayerTurn() {
      try {
        playerMana = maxPlayerMana;
        playerField.forEach(card => {
          if (card) {
            card.canAttack = true;
            console.log(`ÊîªÊíÉÂèØËÉΩ„É™„Çª„ÉÉ„Éà: ${card.name}, canAttack: ${card.canAttack}, effect: ${card.effect}`);
          }
        });
        updateGameDisplay();
        console.log(`„Éó„É¨„Ç§„É§„Éº„Çø„Éº„É≥ÈñãÂßã - „Éû„Éä: ${playerMana}/${maxPlayerMana}`);
      } catch (error) {
        console.error("„Éó„É¨„Ç§„É§„Éº„Çø„Éº„É≥ÈñãÂßã„Ç®„É©„Éº:", error.stack);
      }
    }

    function startAiTurn() {
      try {
        console.log(`AI„Çø„Éº„É≥ÈñãÂßã - „Éû„Éä: ${aiMana}/${maxAiMana}`);
        aiMana = maxAiMana;
        aiField.forEach(card => {
          if (card) {
            card.canAttack = true;
            console.log(`AIÊîªÊíÉÂèØËÉΩ„É™„Çª„ÉÉ„Éà: ${card.name}, canAttack: ${card.canAttack}, effect: ${card.effect}`);
          }
        });
        const playableCards = aiHand.filter(card => card && aiMana >= card.cost && aiField.length < 5);
        if (playableCards.length > 0) {
          const card = playableCards[Math.floor(Math.random() * playableCards.length)];
          let newCard = { ...card, canAttack: card.effect === "rush" };
          if (card.effect === "fanfare") {
            newCard.attack += 1;
            console.log(`AI„Éï„Ç°„É≥„Éï„Ç°„Éº„É¨Áô∫Âãï: ${card.name}, ÊîªÊíÉÂäõ+1 -> ${newCard.attack}`);
          }
          aiField.push(newCard);
          aiMana -= card.cost;
          const cardIndex = aiHand.findIndex(c => c && c.id === card.id && c.cost === card.cost);
          if (cardIndex !== -1) {
            aiHand.splice(cardIndex, 1);
          }
          aiField.forEach(fieldCard => {
            if (fieldCard && fieldCard.effect === "boost") {
              fieldCard.health += 1;
              console.log(`AI„Éñ„Éº„Çπ„ÉàÁô∫Âãï: ${fieldCard.name}, ‰ΩìÂäõ+1 -> ${fieldCard.health}`);
            }
          });
          console.log(`AI„Ç´„Éº„Éâ„Éó„É¨„Ç§: ${card.name}, ÊÆã„Éû„Éä: ${aiMana}, Â†¥„Ç´„Éº„ÉâÊï∞: ${aiField.length}`);
        }
        aiField.forEach((card, index) => {
          if (card && card.canAttack) {
            const hasGuard = playerField.some(c => c && c.effect === "guard");
            let targetCard;
            if (hasGuard) {
              const guardCards = playerField.filter(c => c && c.effect === "guard");
              targetCard = guardCards[Math.floor(Math.random() * guardCards.length)];
              console.log(`AIÊîªÊíÉÂØæË±°Âà∂Èôê: Guard„Ç´„Éº„Éâ (${guardCards.map(c => c.name).join(", ")})`);
            } else if (playerField.length > 0 && Math.random() > 0.5) {
              targetCard = playerField[Math.floor(Math.random() * playerField.length)];
            }
            if (targetCard) {
              targetCard.health -= card.attack;
              card.health -= targetCard.attack;
              card.canAttack = false;
              console.log(`AI„Ç´„Éº„ÉâÊîªÊíÉ: ${card.name} -> ${targetCard.name}, „ÉÄ„É°„Éº„Ç∏: ${card.attack}/${targetCard.attack}`);
            } else {
              playerLife -= card.attack;
              card.canAttack = false;
              console.log(`AIÁõ¥Êé•ÊîªÊíÉ: ${card.name} -> „Éó„É¨„Ç§„É§„Éº„É©„Ç§„Éï, „ÉÄ„É°„Éº„Ç∏: ${card.attack}, „Éó„É¨„Ç§„É§„Éº„É©„Ç§„ÉïÊÆã: ${playerLife}`);
            }
          }
        });
        playerField = playerField.filter(card => card && card.health > 0);
        aiField = aiField.filter(card => card && card.health > 0);
        aiHand.push(...drawCards(1));
        maxAiMana = Math.min(maxAiMana + 1, 10);
        currentTurn = "player";
        updateGameDisplay();
        checkGameEnd();
        startPlayerTurn();
      } catch (error) {
        console.error("AI„Çø„Éº„É≥„Ç®„É©„Éº:", error.stack);
        currentTurn = "player";
        updateGameDisplay();
        startPlayerTurn();
      }
    }

    function checkGameEnd() {
      try {
        if (gameOver) return;
        const resultDiv = document.getElementById("game-result");
        const resultText = document.getElementById("result-text");
        if (playerLife <= 0 && aiLife > 0) {
          gameOver = true;
          resultText.textContent = "AI„ÅÆÂãùÂà©ÔºÅ";
          resultDiv.classList.add("show");
          console.log("„Ç≤„Éº„É†ÁµÇ‰∫Ü: AI„ÅÆÂãùÂà©");
        } else if (aiLife <= 0 && playerLife > 0) {
          gameOver = true;
          resultText.textContent = "„Éó„É¨„Ç§„É§„Éº„ÅÆÂãùÂà©ÔºÅ";
          resultDiv.classList.add("show");
          console.log("„Ç≤„Éº„É†ÁµÇ‰∫Ü: „Éó„É¨„Ç§„É§„Éº„ÅÆÂãùÂà©");
        } else if (playerLife <= 0 && aiLife <= 0) {
          gameOver = true;
          resultText.textContent = "Âºï„ÅçÂàÜ„ÅëÔºÅ";
          resultDiv.classList.add("show");
          console.log("„Ç≤„Éº„É†ÁµÇ‰∫Ü: Âºï„ÅçÂàÜ„Åë");
        }
      } catch (error) {
        console.error("„Ç≤„Éº„É†ÁµÇ‰∫Ü„Ç®„É©„Éº:", error.stack);
      }
    }

    function updateGameStatus() {
      try {
        document.getElementById("game-status").textContent = `„Çø„Éº„É≥: ${turnCount} (${currentTurn === "player" ? "„Éó„É¨„Ç§„É§„Éº" : "AI"})`;
      } catch (error) {
        console.error("„Ç≤„Éº„É†„Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞„Ç®„É©„Éº:", error.stack);
      }
    }

    function setupEventListeners() {
      try {
        const playArea = document.getElementById("play-area");
        const aiInfo = document.getElementById("ai-info");
        const aiField = document.getElementById("ai-field");
        const endTurnButton = document.getElementById("end-turn");
        const resetButton = document.getElementById("reset-button");
        const mulliganConfirmButton = document.getElementById("mulligan-confirm");
        const closeDetailButton = document.getElementById("close-detail");

        if (!playArea || !aiInfo || !aiField || !endTurnButton || !resetButton || !mulliganConfirmButton || !closeDetailButton) {
          throw new Error("ÂøÖË¶Å„Å™DOMË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì: " + JSON.stringify({
            playArea: !!playArea,
            aiInfo: !!aiInfo,
            aiField: !!aiField,
            endTurnButton: !!endTurnButton,
            resetButton: !!resetButton,
            mulliganConfirmButton: !!mulliganConfirmButton,
            closeDetailButton: !!closeDetailButton
          }, null, 2));
        }

        playArea.addEventListener("dragover", event => event.preventDefault());
        playArea.addEventListener("drop", handlePlayDrop);
        aiInfo.addEventListener("dragover", event => event.preventDefault());
        aiInfo.addEventListener("drop", handleAttackDrop);
        aiField.addEventListener("dragover", event => event.preventDefault());
        aiField.addEventListener("drop", handleAttackDrop);

        endTurnButton.removeEventListener("click", handleEndTurn);
        endTurnButton.addEventListener("click", handleEndTurn);

        resetButton.removeEventListener("click", initializeGame);
        resetButton.addEventListener("click", initializeGame);

        mulliganConfirmButton.removeEventListener("click", performMulligan);
        mulliganConfirmButton.addEventListener("click", performMulligan);

        closeDetailButton.removeEventListener("click", () => document.getElementById("card-detail-modal").classList.remove("show"));
        closeDetailButton.addEventListener("click", () => {
          document.getElementById("card-detail-modal").classList.remove("show");
          console.log("„Ç´„Éº„ÉâË©≥Á¥∞„É¢„Éº„ÉÄ„É´Èñâ„Åò„Çã");
        });

        console.log("„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆöÂÆå‰∫Ü");
      } catch (error) {
        console.error("„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö„Ç®„É©„Éº:", error.stack);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      try {
        initializeGame();
        setupEventListeners();
        console.log("DOMContentLoaded: „Ç≤„Éº„É†ÂàùÊúüÂåñ„Å®„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆöÂÆå‰∫Ü");
      } catch (error) {
        console.error("DOMContentLoaded„Ç®„É©„Éº:", error.stack);
      }
    });
  </script>
</body>
</html>